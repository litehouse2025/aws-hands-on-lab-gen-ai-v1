# Huáº¥n Luyá»‡n K-Means vÃ  PhÃ¢n Loáº¡i KhÃ¡ch HÃ ng
---
```python
# step 3: group customers into 4 clusters
random.seed(8)
km=KMeans(n_clusters=4,random_state=0)
km.fit(X)
random.seed(8)
pred=km.predict(X)
df_RFM2=df_RFM2.assign(clusters=pred)
# replace k-means cluster names with more meaningful names
d1={0:"New Customers", 2:"Potential Loyalist", 1: "At-Risk", 3:"Loyal Customers"}
df_RFM2.loc[:,"segments"]=df_RFM2.loc[:,"clusters"].map(d1)

display(df_RFM2.head(5))
```
---
## Tá»•ng Quan

Trong bÆ°á»›c nÃ y, chÃºng ta sáº½:
1. âœ… **Huáº¥n luyá»‡n mÃ´ hÃ¬nh K-Means** vá»›i 4 cá»¥m (Ä‘Æ°á»£c chá»n tá»« Elbow Method)
2. âœ… **Dá»± Ä‘oÃ¡n cá»¥m** cho táº¥t cáº£ khÃ¡ch hÃ ng
3. âœ… **Äáº·t tÃªn Ã½ nghÄ©a** cho má»—i cá»¥m
4. âœ… **Táº¡o cá»™t phÃ¢n loáº¡i** khÃ¡ch hÃ ng

---

## Giáº£i ThÃ­ch Chi Tiáº¿t Tá»«ng BÆ°á»›c

### **BÆ°á»›c 3.1: Thiáº¿t Láº­p Random Seed**

#### **Táº¡i Sao Cáº§n Random Seed?**

**Váº¥n Ä‘á»:**
```
K-Means sá»­ dá»¥ng quÃ¡ trÃ¬nh ngáº«u nhiÃªn (random initialization)
â€¢ Má»—i láº§n cháº¡y mÃ£ â†’ Káº¿t quáº£ cÃ³ thá»ƒ khÃ¡c nhau
â€¢ KhÃ³ so sÃ¡nh vÃ  tÃ¡i hiá»‡n káº¿t quáº£
```

**Giáº£i phÃ¡p:**
```python
random.seed(8)

Ã nghÄ©a:
â€¢ Cá»‘ Ä‘á»‹nh seed = 8
â€¢ Má»—i láº§n cháº¡y mÃ£ â†’ Káº¿t quáº£ GIá»NG NHAU
â€¢ Dá»… kiá»ƒm chá»©ng, tÃ¡i hiá»‡n, vÃ  so sÃ¡nh
```

**TÆ°Æ¡ng tá»± trong K-Means:**
```python
KMeans(random_state=0)

â€¢ random_state=0: Cá»‘ Ä‘á»‹nh seed
â€¢ Má»—i láº§n huáº¥n luyá»‡n â†’ Cá»¥m Ä‘Æ°á»£c chia giá»‘ng nhau
```

---

### **BÆ°á»›c 3.2: Huáº¥n Luyá»‡n K-Means**

#### **Khá»Ÿi Táº¡o MÃ´ HÃ¬nh:**

```python
km = KMeans(n_clusters=4, random_state=0)
```

**Tham sá»‘:**
| Tham sá»‘ | GiÃ¡ trá»‹ | Ã nghÄ©a |
|--------|--------|---------|
| `n_clusters` | 4 | Sá»‘ cá»¥m (tá»« Elbow Method) |
| `random_state` | 0 | Cá»‘ Ä‘á»‹nh seed Ä‘á»ƒ láº·p láº¡i káº¿t quáº£ |

#### **Huáº¥n Luyá»‡n MÃ´ HÃ¬nh:**

```python
km.fit(X)
```

**QuÃ¡ trÃ¬nh:**
```
1. Khá»Ÿi táº¡o: Chá»n 4 tÃ¢m cá»¥m ngáº«u nhiÃªn
2. Láº·p láº¡i:
   - GÃ¡n má»—i Ä‘iá»ƒm vÃ o cá»¥m gáº§n nháº¥t
   - TÃ­nh láº¡i tÃ¢m cá»¥m
   - Náº¿u khÃ´ng thay Ä‘á»•i â†’ Dá»«ng
3. Káº¿t quáº£: 4 cá»¥m vá»›i tÃ¢m cá»¥m xÃ¡c Ä‘á»‹nh

Káº¿t quáº£:
â€¢ km.cluster_centers_: TÃ¢m cá»§a 4 cá»¥m
â€¢ km.inertia_: SSE cuá»‘i cÃ¹ng
â€¢ km.n_iter_: Sá»‘ láº§n láº·p
```

#### **Kiá»ƒm Tra Káº¿t Quáº£ Huáº¥n Luyá»‡n:**

```python
# Xem tÃ¢m cá»¥m
print("TÃ¢m cÃ¡c cá»¥m (RFM chuáº©n hÃ³a):")
print(km.cluster_centers_)

# Xem sá»‘ láº§n láº·p
print(f"Sá»‘ láº§n láº·p: {km.n_iter_}")

# Xem SSE cuá»‘i cÃ¹ng
print(f"SSE: {km.inertia_:.2f}")
```

---

### **BÆ°á»›c 3.3: Dá»± ÄoÃ¡n Cá»¥m**

#### **Dá»± ÄoÃ¡n LÃ  GÃ¬?**

```python
pred = km.predict(X)
```

**Ã nghÄ©a:**
```
â€¢ X: Dá»¯ liá»‡u RFM chuáº©n hÃ³a (má»—i dÃ²ng = 1 khÃ¡ch hÃ ng)
â€¢ pred: Máº£ng chá»©a cá»¥m cá»§a má»—i khÃ¡ch hÃ ng
  - pred[0] = 2 â†’ KhÃ¡ch hÃ ng 0 á»Ÿ cá»¥m 2
  - pred[1] = 0 â†’ KhÃ¡ch hÃ ng 1 á»Ÿ cá»¥m 0
  - ...
```

**CÃ´ng thá»©c dá»± Ä‘oÃ¡n:**
```
Cho 1 khÃ¡ch hÃ ng x:
  Cá»¥m = arg min ||x - c_k||Â²  (k = 0 to 3)
  
Ã: TÃ¬m cá»¥m k mÃ  tÃ¢m c_k gáº§n nháº¥t vá»›i x
```

---

### **BÆ°á»›c 3.4: ThÃªm Cá»™t Cá»¥m**

#### **Táº¡i Sao Cáº§n BÆ°á»›c NÃ y?**

**TrÆ°á»›c:**
```
df_RFM2 (5 cá»™t):
| user_id | Recency | Frequency | Monetary | score |
|---------|---------|-----------| ---------|-------|
| 1001    | 30      | 5         | 500000   | 35    |
| 1002    | 5       | 15        | 1000000  | 95    |
```

**Sau:**
```
Máº£ng pred (riÃªng láº»):
[2, 0, 1, 3, 2, ...]

âŒ KhÃ³ káº¿t ná»‘i khÃ¡ch hÃ ng vá»›i cá»¥m
```

**Giáº£i phÃ¡p:**
```python
df_RFM2 = df_RFM2.assign(clusters=pred)
```

**Káº¿t quáº£:**
```
df_RFM2 (6 cá»™t):
| user_id | Recency | Frequency | Monetary | score | clusters |
|---------|---------|-----------| ---------|-------|----------|
| 1001    | 30      | 5         | 500000   | 35    | 2        |
| 1002    | 5       | 15        | 1000000  | 95    | 0        |

âœ… Má»—i khÃ¡ch hÃ ng cÃ³ cá»¥m tÆ°Æ¡ng á»©ng
```

---

### **BÆ°á»›c 3.5: Äáº·t TÃªn Ã NghÄ©a**

#### **Táº¡i Sao Cáº§n Äáº·t TÃªn?**

**Váº¥n Ä‘á»:**
```
Cá»¥m 0, 1, 2, 3 â†’ KhÃ´ng rÃµ Ã½ nghÄ©a
"Cá»¥m nÃ o lÃ  khÃ¡ch hÃ ng tá»‘t?"
"Cá»¥m nÃ o cáº§n chÃº Ã½?"
```

**Giáº£i phÃ¡p:**
```python
cluster_names = {
    0: "New Customers",
    1: "At-Risk",
    2: "Potential Loyalist",
    3: "Loyal Customers"
}
```

#### **LÃ m Tháº¿ NÃ o Äá»ƒ Äáº·t TÃªn?**

**PhÆ°Æ¡ng phÃ¡p:**
```
1. Huáº¥n luyá»‡n K-Means
2. Xem Ä‘áº·c Ä‘iá»ƒm má»—i cá»¥m (R, F, M trung bÃ¬nh)
3. Äáº·t tÃªn phÃ¹ há»£p

VÃ­ dá»¥ phÃ¢n tÃ­ch:
Cá»¥m 0: R cao, F tháº¥p, M tháº¥p â†’ Má»›i mua â†’ "New Customers"
Cá»¥m 1: R cao, F tháº¥p, M tháº¥p â†’ ChÆ°a quay láº¡i â†’ "At-Risk"
Cá»¥m 2: R trung, F trung, M trung â†’ Tiá»m nÄƒng tÄƒng â†’ "Potential Loyalist"
Cá»¥m 3: R tháº¥p, F cao, M cao â†’ Mua láº¡i thÆ°á»ng xuyÃªn â†’ "Loyal Customers"
```

#### **Ãp Dá»¥ng Mapping:**

```python
# Táº¡o tá»« Ä‘iá»ƒn Ã¡nh xáº¡
d1 = {0: "New Customers", 1: "At-Risk", 2: "Potential Loyalist", 3: "Loyal Customers"}

# Ãp dá»¥ng map() Ä‘á»ƒ chuyá»ƒn Ä‘á»•i
df_RFM2.loc[:, "segments"] = df_RFM2.loc[:, "clusters"].map(d1)

QuÃ¡ trÃ¬nh:
clusters = [0, 1, 2, 3, 0, 1, ...]
    â†“ (map)
segments = ["New Customers", "At-Risk", "Potential Loyalist", "Loyal Customers", ...]
```

**Káº¿t quáº£:**
```
Cá»™t clusters (sá»‘):  0    1      2                3
              â†“      â†“      â†“
Cá»™t segments (tÃªn):  New  At-Risk Potential     Loyal
                     Customers       Loyalist   Customers
```

---

### **BÆ°á»›c 3.6: Hiá»ƒn Thá»‹ Káº¿t Quáº£**

```python
display(df_RFM2.head(5))
```

**Káº¿t quáº£ mong Ä‘á»£i:**
```
| user_id | Recency | Frequency | Monetary | clusters | segments             |
|---------|---------|-----------|----------|----------|----------------------|
| 1001    | 30      | 5         | 500000   | 0        | New Customers        |
| 1002    | 5       | 15        | 1000000  | 3        | Loyal Customers      |
| 1003    | 60      | 2         | 200000   | 1        | At-Risk              |
| 1004    | 45      | 8         | 800000   | 2        | Potential Loyalist   |
| 1005    | 20      | 3         | 400000   | 0        | New Customers        |
```

---
---

**Tiáº¿p theo:** Trá»±c quan hÃ³a dá»¯ liá»‡u customer segments vá»›i biá»ƒu Ä‘á»“  ğŸ“Š