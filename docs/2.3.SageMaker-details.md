# Chi Tiáº¿t Thá»±c Hiá»‡n: SageMaker Notebook cho PhÃ¢n TÃ­ch RFM

## Giá»›i Thiá»‡u vá» Jupyter Notebook

### 1. Jupyter Notebook lÃ  gÃ¬?

**Jupyter Notebook** lÃ  má»™t á»©ng dá»¥ng web mÃ£ nguá»“n má»Ÿ cho phÃ©p báº¡n táº¡o vÃ  chia sáº» cÃ¡c tÃ i liá»‡u chá»©a:
- **Code sá»‘ng Ä‘á»™ng** (executable code)
- **HÃ¬nh áº£nh trá»±c quan** (visualizations)
- **VÄƒn báº£n Markdown** (narrative text)
- **PhÆ°Æ¡ng trÃ¬nh toÃ¡n há»c** (mathematical equations)

Trong bá»‘i cáº£nh AWS SageMaker, Jupyter Notebook Ä‘Æ°á»£c quáº£n lÃ½ hoÃ n toÃ n trÃªn cloud, cho phÃ©p báº¡n lÃ m viá»‡c vá»›i dá»¯ liá»‡u lá»›n mÃ  khÃ´ng cáº§n setup phá»©c táº¡p.

### 2. Æ¯u Äiá»ƒm cá»§a Jupyter Notebook

| Æ¯u Äiá»ƒm | Giáº£i ThÃ­ch |
|---------|-----------|
| **TÆ°Æ¡ng TÃ¡c** | Viáº¿t code, thá»±c thi, xem káº¿t quáº£ ngay láº­p tá»©c |
| **KhÃ¡m PhÃ¡ Dá»¯ Liá»‡u** | Dá»… dÃ ng EDA (Exploratory Data Analysis) |
| **HÃ¬nh Dung** | Váº½ biá»ƒu Ä‘á»“, plot káº¿t quáº£ trá»±c tiáº¿p |
| **TÃ i Liá»‡u** | Káº¿t há»£p code + vÄƒn báº£n + hÃ¬nh áº£nh |
| **Chia Sáº»** | Xuáº¥t thÃ nh HTML, PDF hoáº·c GitHub |
| **Python/R/Julia** | Há»— trá»£ nhiá»u ngÃ´n ngá»¯ láº­p trÃ¬nh |

### 3. Cáº¥u TrÃºc Má»™t Notebook

Má»™t Notebook Ä‘Æ°á»£c chia thÃ nh cÃ¡c **Cell** (Ã´):

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Markdown Cell (Text)                     â”‚
â”‚ Giáº£i thÃ­ch bÃ i toÃ¡n                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Code Cell (Executable Python)            â”‚
â”‚ import pandas as pd                       â”‚
â”‚ df = pd.read_csv('data.csv')             â”‚
â”‚ print(df.head())                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Output Cell (Káº¿t quáº£)                   â”‚
â”‚ Hiá»ƒn thá»‹ output vÃ  biá»ƒu Ä‘á»“               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 4. PhÃ­m Táº¯t Há»¯u Ãch trong Jupyter

| PhÃ­m Táº¯t | MÃ´ Táº£ |
|----------|-------|
| **Shift + Enter** | Cháº¡y cell hiá»‡n táº¡i vÃ  chuyá»ƒn xuá»‘ng |
| **Ctrl + Enter** | Cháº¡y cell hiá»‡n táº¡i |
| **B** | Táº¡o cell má»›i bÃªn dÆ°á»›i |
| **A** | Táº¡o cell má»›i bÃªn trÃªn |
| **M** | Chuyá»ƒn cell thÃ nh Markdown |
| **Y** | Chuyá»ƒn cell thÃ nh Code |
| **D + D** | XÃ³a cell |

---

## Táº£i Dá»¯ Liá»‡u tá»« S3 vÃ o DataFrame

### 1. Tá»•ng Quan

Trong bÃ i lab nÃ y, chÃºng ta sáº½ táº£i dá»¯ liá»‡u giao dá»‹ch cá»§a khÃ¡ch hÃ ng tá»« **AWS S3** (Simple Storage Service). S3 lÃ  dá»‹ch vá»¥ lÆ°u trá»¯ object cá»§a AWS, ráº¥t phÃ¹ há»£p Ä‘á»ƒ lÆ°u trá»¯ cÃ¡c file dá»¯ liá»‡u CSV, JSON, Parquet, v.v.

**Lá»£i Ã­ch cá»§a S3:**
- ğŸ’¾ LÆ°u trá»¯ khÃ´ng giá»›i háº¡n
- ğŸ” Báº£o máº­t cao
- ğŸš€ Tá»‘c Ä‘á»™ truy cáº­p nhanh
- ğŸ’° Chi phÃ­ tháº¥p

### 2. Cáº¥u TrÃºc Dá»¯ Liá»‡u trong S3

```
s3://lab-aws-workshop/          (Bucket)
    â”œâ”€â”€ input_data/             (Prefix/Folder)
    â”‚   â”œâ”€â”€ sales-01.csv        (Month 1 data)
    â”‚   â”œâ”€â”€ sales-02.csv        (Month 2 data)
    â”‚   â”œâ”€â”€ sales-03.csv        (Month 3 data)
    â”‚   â””â”€â”€ ... (nhiá»u file thÃ¡ng khÃ¡c)
    â””â”€â”€ output/                 (Output folder)
        â””â”€â”€ rfm_results.csv
```

**HÃ¬nh áº£nh minh há»a:**

![Dá»¯ liá»‡u tá»« S3](image-6.png)

### 3. Chuáº©n Bá»‹: Thiáº¿t Láº­p S3 Client

TrÆ°á»›c tiÃªn, chÃºng ta cáº§n táº¡o má»™t S3 client Ä‘á»ƒ giao tiáº¿p vá»›i AWS S3:

```python
import boto3
import pandas as pd
from io import BytesIO

# Táº¡o S3 client
s3_client = boto3.client('s3', region_name='us-west-2')

# Kiá»ƒm tra káº¿t ná»‘i
print("âœ… S3 client Ä‘Ã£ Ä‘Æ°á»£c táº¡o thÃ nh cÃ´ng!")
```

**Giáº£i thÃ­ch:**
- `boto3`: AWS SDK cho Python
- `s3_client`: Object dÃ¹ng Ä‘á»ƒ tÆ°Æ¡ng tÃ¡c vá»›i S3
- `region_name`: Region AWS (vÃ­ dá»¥: us-west-2, ap-southeast-1)

### 4. Äá»‹nh NghÄ©a Function Load Dá»¯ Liá»‡u tá»« S3

BÃ¢y giá» chÃºng ta sáº½ táº¡o má»™t function Ä‘á»ƒ táº£i táº¥t cáº£ file CSV tá»« má»™t folder trong S3:

```python
def load_csv_files_from_s3(bucket, prefix):
    """
    Load táº¥t cáº£ file CSV tá»« má»™t folder trong S3 vÃ o má»™t DataFrame duy nháº¥t
    
    Parameters:
    -----------
    bucket : str
        TÃªn S3 bucket (vÃ­ dá»¥: 'lab-aws-workshop')
    prefix : str
        ÄÆ°á»ng dáº«n folder trong S3 (vÃ­ dá»¥: 'input_data/')
    
    Returns:
    --------
    pd.DataFrame
        DataFrame chá»©a táº¥t cáº£ dá»¯ liá»‡u tá»« cÃ¡c file CSV
    
    Raises:
    -------
    Exception: Náº¿u khÃ´ng cÃ³ file CSV nÃ o Ä‘Æ°á»£c tÃ¬m tháº¥y
    
    Example:
    --------
    >>> df = load_csv_files_from_s3('lab-aws-workshop', 'input_data/')
    >>> print(f"Tá»•ng {len(df)} rows Ä‘Ã£ Ä‘Æ°á»£c load")
    """
    
    # Liá»‡t kÃª táº¥t cáº£ object trong S3 folder
    response = s3_client.list_objects_v2(Bucket=bucket, Prefix=prefix)
    
    # Danh sÃ¡ch Ä‘á»ƒ lÆ°u cÃ¡c DataFrame
    frame_list = []
    
    # Kiá»ƒm tra xem cÃ³ file nÃ o khÃ´ng
    if 'Contents' not in response:
        print(f"âŒ KhÃ´ng tÃ¬m tháº¥y file nÃ o trong {bucket}/{prefix}")
        return None
    
    # Láº·p qua tá»«ng object trong S3 folder
    for obj in response.get('Contents', []):
        file_key = obj['Key']
        
        # Chá»‰ xá»­ lÃ½ file CSV
        if file_key.endswith('.csv'):
            print(f"ğŸ“‚ Äang load {file_key}...")
            
            try:
                # Get object tá»« S3
                obj_data = s3_client.get_object(Bucket=bucket, Key=file_key)
                
                # Äá»c CSV vÃ o DataFrame
                df_i = pd.read_csv(obj_data['Body'])
                
                # ThÃªm cá»™t 'month' tá»« tÃªn file
                # VÃ­ dá»¥: 'sales-01.csv' â†’ month = '01'
                month = file_key.split('-')[-1].replace('.csv', '')
                df_i['month'] = month
                
                # ThÃªm DataFrame vÃ o danh sÃ¡ch
                frame_list.append(df_i)
                print(f"  âœ… Loaded thÃ nh cÃ´ng: {len(df_i)} rows")
                
            except Exception as e:
                print(f"  âŒ Lá»—i khi load {file_key}: {e}")
                continue
    
    # Kiá»ƒm tra xem cÃ³ file nÃ o Ä‘Æ°á»£c load khÃ´ng
    if not frame_list:
        print("âŒ KhÃ´ng cÃ³ file CSV nÃ o Ä‘Æ°á»£c load!")
        return None
    
    # Gá»™p táº¥t cáº£ DataFrame thÃ nh má»™t DataFrame duy nháº¥t
    df = pd.concat(frame_list, ignore_index=True, sort=False)
    
    return df
```

### 6. Giáº£i ThÃ­ch Chi Tiáº¿t Äoáº¡n Code

#### **Pháº§n 1: Liá»‡t KÃª File**
```python
response = s3_client.list_objects_v2(Bucket=bucket, Prefix=prefix)
```
- `list_objects_v2()`: Gá»i AWS API Ä‘á»ƒ láº¥y danh sÃ¡ch object trong S3
- `Bucket`: TÃªn bucket S3
- `Prefix`: Folder path (vÃ­ dá»¥: 'input_data/')

#### **Pháº§n 2: Kiá»ƒm Tra Xem CÃ³ File KhÃ´ng**
```python
if 'Contents' not in response:
    print(f"KhÃ´ng tÃ¬m tháº¥y file nÃ o...")
    return None
```
- `Contents`: Key chá»©a danh sÃ¡ch file. Náº¿u khÃ´ng cÃ³, folder trá»‘ng.

#### **Pháº§n 3: Láº·p Qua Tá»«ng File**
```python
for obj in response.get('Contents', []):
    file_key = obj['Key']  # ÄÆ°á»ng dáº«n Ä‘áº§y Ä‘á»§ cá»§a file
```

#### **Pháº§n 4: Kiá»ƒm Tra Äá»‹nh Dáº¡ng File**
```python
if file_key.endswith('.csv'):
    # Chá»‰ xá»­ lÃ½ file CSV
```

#### **Pháº§n 5: Get File tá»« S3**
```python
obj_data = s3_client.get_object(Bucket=bucket, Key=file_key)
df_i = pd.read_csv(obj_data['Body'])
```
- `get_object()`: Láº¥y file tá»« S3
- `obj_data['Body']`: Ná»™i dung file
- `pd.read_csv()`: Äá»c CSV

#### **Pháº§n 6: ThÃªm ThÃ´ng Tin Metadata**
```python
month = file_key.split('-')[-1].replace('.csv', '')
df_i['month'] = month
```
- TrÃ­ch xuáº¥t thÃ¡ng tá»« tÃªn file
- ThÃªm cá»™t 'month' Ä‘á»ƒ theo dÃµi dá»¯ liá»‡u tá»« thÃ¡ng nÃ o

#### **Pháº§n 7: Gá»™p Dá»¯ Liá»‡u**
```python
df = pd.concat(frame_list, ignore_index=True, sort=False)
```
- `pd.concat()`: Gá»™p nhiá»u DataFrame thÃ nh má»™t
- `ignore_index=True`: Reset index
- `sort=False`: KhÃ´ng sáº¯p xáº¿p cá»™t

---

**Tiáº¿p theo:** HÃ£y sang pháº§n tÃ­nh toÃ¡n chá»‰ sá»‘ RFM tá»« dá»¯ liá»‡u Ä‘Ã£ load!