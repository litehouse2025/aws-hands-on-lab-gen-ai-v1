
```python 
# k-means clustering: using recency, frequency, and monetary as clustering varaibles

# step 1: standardize data
df_RFM3=df_RFM2.drop(columns=['user_id'])
X = StandardScaler().fit_transform(df_RFM3)

# step 2: find the optimal number of clusters
SSE=[]
for i in range(1,8,1):
    kmeans=KMeans(n_clusters=i)
    kmeans.fit(X)
    SSE.append(kmeans.inertia_)
sns.set()
plt.plot(range(1,8,1),SSE,marker='o')
plt.xlabel('number of clusters')
plt.ylabel('squared error');
```
---
![Biá»ƒu Ä‘á»“ Elbow](image-8.png)

---
## Giáº£i ThÃ­ch Chi Tiáº¿t Tá»«ng BÆ°á»›c

### **BÆ°á»›c 1: Chuáº©n HÃ³a Dá»¯ Liá»‡u (Data Standardization)**

#### **Táº¡i Sao Pháº£i Chuáº©n HÃ³a?**

**Váº¥n Ä‘á»:** RFM cÃ³ cÃ¡c scale (tá»· lá»‡) khÃ¡c nhau:
```
VÃ­ dá»¥:
â€¢ Recency: 0-365 ngÃ y         (scale nhá»)
â€¢ Frequency: 1-50 láº§n         (scale nhá»)
â€¢ Monetary: 100-1,000,000 VND (scale Lá»šN)

â†’ Monetary chi phá»‘i cÃ¡c phÃ©p tÃ­nh K-Means
â†’ Recency & Frequency bá»‹ bá» qua
```

**Giáº£i phÃ¡p:** Chuáº©n hÃ³a táº¥t cáº£ vá» cÃ¹ng má»™t scale
```
CÃ´ng thá»©c StandardScaler:
x_standardized = (x - mean) / std

Káº¿t quáº£:
â€¢ Mean = 0
â€¢ Standard deviation = 1
â€¢ Táº¥t cáº£ biáº¿n cÃ³ táº§m quan trá»ng báº±ng nhau
```

#### **Code Chi Tiáº¿t:**

```python
# XÃ³a cá»™t user_id (chá»‰ giá»¯ R, F, M)
df_RFM3 = df_RFM2.drop(columns=['user_id'])
# Result: DataFrame vá»›i 3 cá»™t [Recency, Frequency, Monetary]

# Chuáº©n hÃ³a dá»¯ liá»‡u
X = StandardScaler().fit_transform(df_RFM3)
# Result: numpy array vá»›i shape (n_customers, 3)
#         Má»—i cá»™t cÃ³ mean=0, std=1
```

#### **Kiá»ƒm Tra Dá»¯ Liá»‡u Sau Chuáº©n HÃ³a:**

```python
# Hiá»ƒn thá»‹ 5 dÃ²ng Ä‘áº§u
print("5 dÃ²ng Ä‘áº§u sau chuáº©n hÃ³a:")
print(X[:5])

# Kiá»ƒm tra mean vÃ  std
print(f"\nMean: {X.mean(axis=0)}")      # Gáº§n 0
print(f"Std: {X.std(axis=0)}")         # Gáº§n 1

# Hiá»ƒu thÃªm vá» chuáº©n hÃ³a
print("\nSo sÃ¡nh trÆ°á»›c vÃ  sau chuáº©n hÃ³a:")
print(f"Recency trÆ°á»›c:      min={df_RFM3['Recency'].min()}, max={df_RFM3['Recency'].max()}")
print(f"Recency sau:        min={X[:, 0].min():.2f}, max={X[:, 0].max():.2f}")
print(f"Monetary trÆ°á»›c:     min={df_RFM3['Monetary'].min()}, max={df_RFM3['Monetary'].max()}")
print(f"Monetary sau:       min={X[:, 2].min():.2f}, max={X[:, 2].max():.2f}")
```

---

### **BÆ°á»›c 2: TÃ¬m Sá»‘ Cá»¥m Tá»‘i Æ¯u (Elbow Method)**

#### **SSE (Sum of Squared Errors) LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
SSE = Î£ (Ä‘iá»ƒm - trung tÃ¢m cá»¥m)Â²

Giáº£i thÃ­ch:
â€¢ Äo lÆ°á»ng khoáº£ng cÃ¡ch giá»¯a cÃ¡c Ä‘iá»ƒm vÃ  tÃ¢m cá»¥m
â€¢ SSE nhá» â†’ cá»¥m compact â†’ mÃ´ hÃ¬nh tá»‘t
â€¢ SSE lá»›n â†’ cá»¥m phÃ¢n tÃ¡n â†’ mÃ´ hÃ¬nh kÃ©m
```

**CÃ´ng thá»©c:**
```
Vá»›i K cá»¥m:
  SSE = Î£ Î£ ||x_i - c_k||Â²
  
Trong Ä‘Ã³:
  x_i: Ä‘iá»ƒm dá»¯ liá»‡u
  c_k: tÃ¢m cá»¥m k
  ||...||Â²: bÃ¬nh phÆ°Æ¡ng khoáº£ng cÃ¡ch Euclidean
```

#### **Elbow Method LÃ  GÃ¬?**

**Ã tÆ°á»Ÿng:**
```
â€¢ TÄƒng K â†’ SSE giáº£m (táº¥t nhiÃªn)
â€¢ NhÆ°ng pháº§n giáº£m sáº½ "cháº­m láº¡i" á»Ÿ má»™t Ä‘iá»ƒm
â€¢ Äiá»ƒm Ä‘Ã³ gá»i lÃ  "khuá»·u" (elbow)
â€¢ ÄÃ³ lÃ  sá»‘ cá»¥m tá»‘i Æ°u

Biá»ƒu Ä‘á»“:
SSE
â”‚     
â”‚  â•²â•²â•²   (Giáº£m nhanh)
â”‚      â•²â•² (Giáº£m cháº­m dáº§n) â† Khuá»·u á»Ÿ Ä‘Ã¢y
â”‚        â•²
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â•²â”€â”€â”€â”€â”€â”€â–º K (sá»‘ cá»¥m)
  1 2 3 4 5 6 7
```

#### **Code Chi Tiáº¿t:**

```python
# Danh sÃ¡ch Ä‘á»ƒ lÆ°u SSE
SSE = []

# Thá»­ tá»« 1 Ä‘áº¿n 7 cá»¥m
for i in range(1, 8, 1):
    # Táº¡o mÃ´ hÃ¬nh K-Means
    kmeans = KMeans(n_clusters=i, random_state=42, n_init=10)
    
    # Huáº¥n luyá»‡n (fit) mÃ´ hÃ¬nh
    kmeans.fit(X)
    
    # LÆ°u SSE (inertia = Sum of Squared Errors)
    SSE.append(kmeans.inertia_)
    
    print(f"K={i}: SSE={kmeans.inertia_:.2f}")

# Output mong Ä‘á»£i:
# K=1: SSE=2500.45
# K=2: SSE=1800.32
# K=3: SSE=1200.50
# K=4: SSE=900.20    â† Giáº£m 300 (tá»‘c Ä‘á»™ cháº­m láº¡i)
# K=5: SSE=850.10    â† Giáº£m 50  (giáº£m Ã­t hÆ¡n)
# K=6: SSE=820.05    â† Giáº£m 30  (giáº£m ráº¥t Ã­t)
# K=7: SSE=800.00    â† Giáº£m 20  (khÃ´ng cÃ²n lá»£i Ã­ch)
```

**Tham sá»‘ quan trá»ng:**
- `n_clusters=i`: Sá»‘ cá»¥m cáº§n táº¡o
- `random_state=42`: Äá»ƒ káº¿t quáº£ láº·p láº¡i
- `n_init=10`: Thá»­ 10 láº§n init khÃ¡c nhau, chá»n tá»‘t nháº¥t
- `kmeans.inertia_`: SSE cá»§a mÃ´ hÃ¬nh

---

### **BÆ°á»›c 3: Váº½ Biá»ƒu Äá»“ Elbow**

#### **Hiá»ƒu Biá»ƒu Äá»“:**

```python
# Váº½ biá»ƒu Ä‘á»“
plt.plot(range(1, 8, 1), SSE, marker='o', linewidth=2, markersize=8)
plt.xlabel('Sá»‘ Cá»¥m (K)')
plt.ylabel('Sum of Squared Errors (SSE)')
plt.title('Elbow Method')
plt.grid(True, alpha=0.3)
plt.show()
```

**Biá»ƒu Ä‘á»“ káº¿t quáº£:**
```
SSE
â”‚
2500â”‚ â—
     â”‚  â•²
2000â”‚   â—â•²
     â”‚    â•²â•²
1500â”‚     â—â•²
     â”‚      â•²
1000â”‚       â—â—     â† Khuá»·u (elbow) á»Ÿ K=4 hoáº·c K=5
     â”‚        â•²â•²â•²
 500â”‚          â—â—â—
     â”‚
   0â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º K
     1 2 3 4 5 6 7
```

#### **CÃ¡ch Chá»n Sá»‘ Cá»¥m Tá»‘i Æ¯u:**

1. **NhÃ¬n biá»ƒu Ä‘á»“** â†’ TÃ¬m Ä‘iá»ƒm "khuá»·u"
2. **Kiá»ƒm tra SSE** â†’ TÃ¬m nÆ¡i giáº£m cháº­m láº¡i
3. **CÃ¢n nháº¯c** â†’ KhÃ´ng quÃ¡ Ã­t (khÃ´ng phÃ¢n biá»‡t Ä‘Æ°á»£c), khÃ´ng quÃ¡ nhiá»u (quÃ¡ chi tiáº¿t)

**VÃ­ dá»¥ quyáº¿t Ä‘á»‹nh:**
```
Náº¿u SSE giáº£m nhÆ° sau:
K=1 â†’ 2500
K=2 â†’ 1800   (giáº£m 700)  âœ“ Lá»›n
K=3 â†’ 1200   (giáº£m 600)  âœ“ Lá»›n
K=4 â†’ 900    (giáº£m 300)  ~ Trung bÃ¬nh
K=5 â†’ 850    (giáº£m 50)   âœ— Nhá» (khuá»·u!)
K=6 â†’ 820    (giáº£m 30)   âœ— QuÃ¡ nhá»
K=7 â†’ 800    (giáº£m 20)   âœ— QuÃ¡ nhá»

â†’ Chá»n K = 4 hoáº·c K = 5 lÃ  tá»‘t nháº¥t
```
---

**Tiáº¿p theo:** HÃ£y tiáº¿p tá»¥c vá»›i pháº§n <> ğŸš€