# Cáº¥u HÃ¬nh Chi Tiáº¿t AI Agent trÃªn AWS Bedrock

## Tá»•ng Quan

á» pháº§n trÆ°á»›c, Ä‘Ã£ táº¡o thÃ nh cÃ´ng **2 Knowledge Bases**. Sang pháº§n nÃ y, chÃºng ta sáº½ cáº¥u hÃ¬nh chi tiáº¿t cÃ¡c tÃ­nh nÄƒng cho AI Agent Ä‘á»ƒ táº¡o thÃ nh má»™t **Agent cÆ¡ báº£n hoÃ n chá»‰nh**.

### **CÃ¡c TÃ­nh NÄƒng Sáº½ Cáº¥u HÃ¬nh:**

1. âœ… **Agent Role** - IAM role cho phÃ©p Agent thá»±c hiá»‡n hÃ nh Ä‘á»™ng
2. âœ… **Model LLM** - Chá»n mÃ´ hÃ¬nh AI phÃ¹ há»£p
3. âœ… **Instructions** - HÆ°á»›ng dáº«n hÃ nh vi Agent
4. âœ… **Knowledge Bases** - Káº¿t ná»‘i 2 Knowledge Bases
5. âœ… **Guardrails** - Báº£o vá»‡ Agent khá»i xá»­ lÃ½ khÃ´ng an toÃ n
6. âœ… **Action groups** - Cáº¥u hÃ¬nh cÃ¡c Tools/Actions mÃ  Agent cÃ³ thá»ƒ gá»i

---

## HÆ°á»›ng Dáº«n Chi Tiáº¿t Tá»«ng Cáº¥u HÃ¬nh

### **BÆ°á»›c 0ï¸âƒ£: VÃ o Agent Builder**

#### **CÃ¡c BÆ°á»›c:**

1. **Truy Cáº­p AWS Bedrock Console**
   ```
   URL: https://console.aws.amazon.com/bedrock
   Menu: Build â†’ Agents
   ```

2. **Chá»n Agent Vá»«a Táº¡o**
   ```
   TÃ¬m: "agent-demo-workshop"
   Click vÃ o agent nÃ y
   ```

3. **Báº¥m "Edit in Agent Builder"**
   ```
   NÃºt: "Edit in Agent Builder" (gÃ³c pháº£i trÃªn)
   Hoáº·c: VÃ o chi tiáº¿t agent â†’ Tab "Edit"
   
   Giao diá»‡n Agent Builder sáº½ má»Ÿ ra
   ```

4. **Giao Diá»‡n Agent Builder**
   ```
   Hiá»ƒn thá»‹:
   â€¢ Agent name á»Ÿ trÃªn cÃ¹ng
   â€¢ Menu bÃªn trÃ¡i (Settings, Instructions, ...)
   â€¢ Main content area (Edit fields)
   â€¢ Save button (gÃ³c pháº£i trÃªn)
   ```

---

## 1ï¸âƒ£ Cáº¥u HÃ¬nh Agent Role

### **Agent Role LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Agent Role = IAM Role cho phÃ©p Agent thá»±c hiá»‡n actions
â€¢ Truy cáº­p S3 buckets
â€¢ Gá»i Lambda functions
â€¢ Truy cáº­p databases
â€¢ Gá»­i emails
â€¢ Cáº­p nháº­t records
```

**Táº¡i Sao Cáº§n?**
```
âœ… Security: Kiá»ƒm soÃ¡t quyá»n cá»§a Agent
âœ… Isolation: Agent chá»‰ cÃ³ quyá»n cáº§n thiáº¿t
âœ… Audit: Theo dÃµi Agent actions
âœ… Governance: TuÃ¢n thá»§ policies
```

### **HÆ°á»›ng Dáº«n Cáº¥u HÃ¬nh Role**

![cáº¥u hÃ¬nh role](image-28.png)

#### **CÃ¡c BÆ°á»›c:**

1. **VÃ o Settings Tab**
   ```
   Menu trÃ¡i: Settings (hoáº·c Overview)
   Hoáº·c: TÃ¬m section "Agent configuration"
   ```

2. **TÃ¬m Field "IAM Role" (hoáº·c "Agent Execution Role")**
   ```
   Field: "IAM role for agent execution"
   Hiá»‡n táº¡i: [Default role hoáº·c khÃ´ng chá»n]
   ```

3. **Báº¥m Dropdown hoáº·c "Change Role"**
   ```
   NÃºt: Dropdown "Select IAM role"
   Danh sÃ¡ch role sáº½ hiá»‡n ra
   ```

4. **TÃ¬m VÃ  Chá»n Role ChÃ­nh XÃ¡c**
   ```
   TÃ¬m: "AmazonBedrockExecutionRoleForAgents_CSZ8RZ6GK66"
   
   Hoáº·c:
   â€¢ AmazonBedrockExecutionRole*
   â€¢ BedrockAgent*
   â€¢ Báº¥t ká»³ role cÃ³ "Bedrock" trong tÃªn
   
   Click chá»n role nÃ y
   ```

---

## 2ï¸âƒ£ Cáº¥u HÃ¬nh Model LLM

### **Model LLM LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Model LLM = Large Language Model lÃ  "bá»™ nÃ£o" cá»§a Agent
â€¢ Claude 3.5 Sonnet: Reasoning tá»‘t, cháº­m hÆ¡n
â€¢ Claude 3 Haiku: Nhanh, chi phÃ­ tháº¥p
â€¢ Llama 2: Open-source, tá»‘c Ä‘á»™ tá»‘t
â€¢ Nova Lite: Nhanh, tá»‘i Æ°u cost (KhuyÃªn dÃ¹ng)
â€¢ Nova Pro: Máº¡nh hÆ¡n Nova Lite
```

### **So SÃ¡nh CÃ¡c Model**

| Model | Speed | Quality | Cost | Best For |
|-------|-------|---------|------|----------|
| **Nova Lite** | âš¡âš¡âš¡ | â­â­â­ | $ | Simple tasks |
| **Nova Pro** | âš¡âš¡ | â­â­â­â­ | $$ | Balanced |
| **Claude 3.5 Sonnet** | âš¡ | â­â­â­â­â­ | $$$ | Complex reasoning |
| **Claude 3 Haiku** | âš¡âš¡ | â­â­â­ | $ | Budget-friendly |

**Khuyáº¿n nghá»‹ cho Lab:** **Nova Lite** (tá»‘c Ä‘á»™, chi phÃ­, Ä‘á»§ tá»‘t)

### **HÆ°á»›ng Dáº«n Cáº¥u HÃ¬nh Model**

![cáº¥u hÃ¬nh model](image-29.png)

#### **CÃ¡c BÆ°á»›c:**

1. **VÃ o Settings Tab**
   ```
   Menu trÃ¡i: Settings (hoáº·c Model selection)
   TÃ¬m: "Model configuration" section
   ```

2. **TÃ¬m Field "Model"**
   ```
   Field: "Select LLM model" hoáº·c "Model"
   Hiá»‡n táº¡i: [Model Ä‘Æ°á»£c chá»n]
   ```

3. **Báº¥m Dropdown**
   ```
   NÃºt: Dropdown "Change model" hoáº·c "Select model"
   Danh sÃ¡ch model sáº½ hiá»‡n ra
   ```

4. **Chá»n Model Nova Lite**
   ```
   TÃ¬m: "us.amazon.nova-lite" 
   Hoáº·c: "Nova Lite" trong danh sÃ¡ch
   
   Äáº§y Ä‘á»§ name cÃ³ thá»ƒ:
   â€¢ amazon.nova-lite-v1:0
   â€¢ us.amazon.nova-lite-v1:0
   â€¢ us.amazon.nova-lite
   
   Click chá»n model nÃ y
   ```

5. **Kiá»ƒm Tra Model Configuration**
   ```
   Hiá»ƒn thá»‹:
   â€¢ Model Name: Nova Lite
   â€¢ Provider: Amazon
   â€¢ Status: âœ“ Available
   â€¢ Max input tokens: [n]
   â€¢ Max output tokens: [m]
   
   âœ… XÃ¡c nháº­n: Model Ä‘Æ°á»£c chá»n
   ```

---

## 3ï¸âƒ£ Cáº¥u HÃ¬nh Instructions for the Agent

### **Instructions LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Instructions = System prompt cho Agent
â€¢ HÆ°á»›ng dáº«n cÃ¡ch hoáº¡t Ä‘á»™ng
â€¢ Constraints & rules
â€¢ Output format
â€¢ Personality & tone
â€¢ Examples
```

**Táº¡i Sao Cáº§n?**
```
âœ… Behavior: Äá»‹nh hÃ¬nh cÃ¡ch Agent hoáº¡t Ä‘á»™ng
âœ… Quality: Output phÃ¹ há»£p vá»›i yÃªu cáº§u
âœ… Consistency: Káº¿t quáº£ nháº¥t quÃ¡n
âœ… Safety: Giá»›i háº¡n nhá»¯ng gÃ¬ Agent lÃ m
âœ… Context: Cung cáº¥p background information
```

### **HÆ°á»›ng Dáº«n Cáº¥u HÃ¬nh Instructions**

![cáº¥u hÃ¬nh instructions for the Agent](image-30.png)

#### **CÃ¡c BÆ°á»›c:**

1. **VÃ o Instructions Tab**
   ```
   Menu trÃ¡i: Instructions
   Hoáº·c: TÃ¬m "Agent Instructions" section
   ```

2. **TÃ¬m Field "Instructions" hoáº·c "System Prompt"**
   ```
   Field: Large text area
   Hiá»‡n táº¡i: [Default text hoáº·c trá»‘ng]
   ```

3. **Click vÃ o Text Area Ä‘á»ƒ Edit**
   ```
   Text area sáº½ focus
   Cursor náº±m trong
   CÃ³ thá»ƒ type/paste
   ```

4. **Viáº¿t Instructions Cho Agent**
   ```
   You are a product recommendation agent with access to two knowledge bases:

   KNOWLEDGE BASE 1 - Customer Segmentation KB:
   - Contains: Customer segment definitions, demographics, behaviors, purchase patterns, preferences
   - Use when: You need to understand customer segments and their characteristics
   - Query first: Always start by retrieving all customer segments from this KB

   KNOWLEDGE BASE 2 - Product Catalog KB:
   - Contains: Product information, features, pricing, categories, specifications, availability
   - Use when: You need product details to match with customer segments
   - Query second: After understanding segments, find matching products from this KB

   ACTION TOOLS AVAILABLE:
   - save_s3: MUST be used to save recommendation results to S3

   WORKFLOW:
   Step 1: Query Customer Segmentation KB to get all segments
   Step 2: For each segment, analyze their characteristics
   Step 3: Query Product Catalog KB to find suitable products for each segment
   Step 4: Match products to segments based on demographics, preferences, and behaviors
   Step 5: Format output as JSON
   Step 6: Explain the reason why you do that
   Step 7: Display results to the user on chat (DO NOT save to S3 unless explicitly asked)

   SAVING TO S3 - OPTIONAL:
   - Only call save_s3 when user explicitly asks to "save results to S3" or "save to S3" or "save analysis"
   - Do NOT automatically save to S3 after analysis
   - When user asks to save, call the save_s3 function and confirm with the S3 path

   KNOWLEDGE BASE USAGE:
   - Use "knowledge-base-customer" to understand WHO the customers are (segments, demographics, behaviors, preferences)
   - Use "knowledge-base-product" to understand WHAT products are available (features, pricing, categories, target audience)
   - Cross-reference information from both KBs to create optimal matches

   When the user asks to save results to S3, you must:
   1. First, perform the customer segment analysis (if not already done)
   2. Then, call the "save_s3" action with the analysis results
   3. Pass the analysis as a JSON string in the "analysis_result" parameter
   4. After save succeeds, confirm to user with the S3 path

   IMPORTANT:
   - Never save to S3 automatically or proactively
   - Wait for explicit user request to save (e.g., "save to S3", "save results", "save this analysis")
   - Display analysis results on chat first, then save only when requested
   ```

---

## 4ï¸âƒ£ Cáº¥u HÃ¬nh Knowledge Bases

### **Knowledge Bases LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Knowledge Bases = Dá»¯ liá»‡u mÃ  Agent cÃ³ thá»ƒ truy cáº­p & sá»­ dá»¥ng
â€¢ RAG (Retrieval Augmented Generation)
â€¢ Vector similarity search
â€¢ Context for better answers
```

**Táº¡i Sao Cáº§n?**
```
âœ… Data: Cung cáº¥p dá»¯ liá»‡u thá»±c cho Agent
âœ… Accuracy: LLM cÃ³ thá»ƒ tham chiáº¿u dá»¯ liá»‡u
âœ… Context: Giáº£m hallucinations
âœ… Freshness: Dá»… update dá»¯ liá»‡u
```

### **2 Knowledge Bases Cáº§n Káº¿t Ná»‘i**

```
1ï¸âƒ£ Customer Segmentation KB
   â€¢ Name: knowledge-base-customer
   â€¢ Data: RFM segments, customer metrics
   â€¢ Usage: PhÃ¢n tÃ­ch nhÃ³m khÃ¡ch hÃ ng
   
2ï¸âƒ£ Product Catalog KB
   â€¢ Name: knowledge-base-product
   â€¢ Data: Product info, features, pricing
   â€¢ Usage: Gá»£i Ã½ sáº£n pháº©m
```

### **HÆ°á»›ng Dáº«n Cáº¥u HÃ¬nh Knowledge Bases**

![cáº¥u hÃ¬nh knowledge bases](image-31.png)

#### **CÃ¡c BÆ°á»›c:**

1. **VÃ o Knowledge Bases Tab**
   ```
   Menu trÃ¡i: Knowledge bases
   Hoáº·c: TÃ¬m "Add Knowledge Base" section
   ```

2. **Báº¥m "Add Knowledge Base"**
   ```
   NÃºt: "Add Knowledge Base" hoáº·c "Add"
   Dialog/dropdown sáº½ má»Ÿ ra
   ```

3. **Chá»n Knowledge Base Äáº§u TiÃªn**
   ```
   Danh sÃ¡ch KB sáº½ hiá»‡n ra
   
   Chá»n: "customer-segmentation-kb"
   â€¢ Hiá»ƒn thá»‹: KB name, created date
   â€¢ Status: Ready âœ“
   
   Click chá»n KB nÃ y
   ```

4. **Kiá»ƒm Tra KB 1 ÄÆ°á»£c ThÃªm**
   ```
   Hiá»ƒn thá»‹:
   â€¢ KB Name: customer-segmentation-kb
   â€¢ Status: âœ“ Connected
   â€¢ Data Source: 1
   â€¢ Vectors: Indexed
   
   âœ… XÃ¡c nháº­n: KB Ä‘Æ°á»£c thÃªm
   ```

5. **Báº¥m "Add Knowledge Base" Láº§n 2**
   ```
   NÃºt: "Add Knowledge Base" hoáº·c "Add"
   Dialog sáº½ má»Ÿ ra láº§n 2
   ```

6. **Chá»n Knowledge Base Thá»© 2**
   ```
   Danh sÃ¡ch KB sáº½ hiá»‡n ra
   
   Chá»n: "product-catalog-kb"
   â€¢ Hiá»ƒn thá»‹: KB name, created date
   â€¢ Status: Ready âœ“
   
   Click chá»n KB nÃ y
   ```

7. **Kiá»ƒm Tra KB 2 ÄÆ°á»£c ThÃªm**
   ```
   Hiá»ƒn thá»‹:
   â€¢ KB 1: customer-segmentation-kb âœ“
   â€¢ KB 2: product-catalog-kb âœ“
   
   âœ… XÃ¡c nháº­n: Cáº£ 2 KB Ä‘Æ°á»£c káº¿t ná»‘i
   ```

---

## 5ï¸âƒ£ Cáº¥u HÃ¬nh Guardrails

![cáº¥u hÃ¬nh guardrail](image-32.png)

### **Guardrails LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Guardrails = Báº£o vá»‡ an toÃ n cho Agent
â€¢ Content filtering
â€¢ Jailbreak prevention
â€¢ PII (Personally Identifiable Info) protection
â€¢ Harmful content detection
â€¢ Policy enforcement
```

### **CÃ¡c Loáº¡i Guardrails**

```
1ï¸âƒ£ Content Filtering
   â€¢ NgÃ´n ngá»¯ khÃ´ng thÃ­ch há»£p
   â€¢ Tá»™i pháº¡m/báº¡o lá»±c
   â€¢ Hate speech
   â€¢ Adult content

2ï¸âƒ£ PII Protection
   â€¢ KhÃ´ng tiáº¿t lá»™ email
   â€¢ KhÃ´ng tiáº¿t lá»™ phone numbers
   â€¢ KhÃ´ng tiáº¿t lá»™ SSN
   â€¢ KhÃ´ng tiáº¿t lá»™ credit cards

3ï¸âƒ£ Custom Policies
   â€¢ Company-specific rules
   â€¢ Industry regulations
   â€¢ Business logic
   â€¢ Custom constraints

4ï¸âƒ£ Harmful Content Detection
   â€¢ Phishing attempts
   â€¢ Malware distribution
   â€¢ Scams
   â€¢ Misinformation
```

---

## 6ï¸âƒ£ Cáº¥u HÃ¬nh Action Groups (Tools)

### **Action Groups LÃ  GÃ¬?**

**Äá»‹nh nghÄ©a:**
```
Action Groups = Táº­p há»£p cÃ¡c Tools/Actions mÃ  Agent cÃ³ thá»ƒ gá»i
â€¢ Lambda functions
â€¢ API integrations
â€¢ Database queries
â€¢ External services
â€¢ Custom logic
```

### **So SÃ¡nh: KhÃ´ng CÃ³ vs CÃ³ Action Groups**

**âŒ KhÃ´ng CÃ³ Action Groups:**
```
User: "Gá»­i email khuyáº¿n nghá»‹ cho customer 123"

Agent: "Dá»±a trÃªn dá»¯ liá»‡u, tÃ´i khuyÃªn gá»­i email nhÆ° sau:
  Subject: Recommended Products
  Body: ...
  
  (Chá»‰ táº¡o draft text, khÃ´ng thá»±c sá»± gá»­i)"
```

**âœ… CÃ³ Action Groups:**
```
User: "Gá»­i email khuyáº¿n nghá»‹ cho customer 123"

Agent: 
  1. Láº¥y customer profile (Tool: GetCustomerProfile)
  2. Láº¥y recommended products (Tool: GetRecommendations)
  3. Soáº¡n email (LLM generates content)
  4. Gá»­i email (Tool: SendEmail)
  5. Cáº­p nháº­t tracking (Tool: UpdateTracking)
  
  â†’ Email thá»±c sá»± Ä‘Æ°á»£c gá»­i!
```

### **Action Groups Architecture**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         AI Agent (LLM)                  â”‚
â”‚  "Gá»£i Ã½ sáº£n pháº©m cho customer 123"     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â–¼
     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
     â”‚  Action Groups        â”‚
     â”‚  (Orchestrator)       â”‚
     â””â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”¬â”€â”€â”€â”˜
         â”‚   â”‚   â”‚   â”‚   â”‚
    â”Œâ”€â”€â”€â”€â–¼â”â”Œâ”€â–¼â”€â”€â”€â”â”Œâ”€â”€â–¼â”€â”€â”â”Œâ”€â–¼â”€â”€â”€â”€â”â”Œâ”€â–¼â”€â”€â”€â”€â”
    â”‚Get  â”‚â”‚Get  â”‚â”‚Send â”‚â”‚Updateâ”‚â”‚Log   â”‚
    â”‚Cust â”‚â”‚Recomâ”‚â”‚Emailâ”‚â”‚Cust  â”‚â”‚Inter â”‚
    â”‚Data â”‚â”‚mend â”‚â”‚     â”‚â”‚Profileâ”‚â”‚action
    â””â”€â”€â”€â”€â”¬â”˜â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”€â”˜â””â”€â”€â”¬â”€â”€â”€â”˜
         â”‚    â”‚      â”‚      â”‚      â”‚
         â–¼    â–¼      â–¼      â–¼      â–¼
       [Database] [API] [Email] [CRM]
```

### **HÆ°á»›ng Dáº«n Cáº¥u HÃ¬nh Action Groups**

#### **BÆ°á»›c 1: VÃ o Action Groups Tab**

```
Menu trÃ¡i: Action Groups (hoáº·c Tools)
Hoáº·c: TÃ¬m "Add Action Group" section

Hiá»ƒn thá»‹:
â€¢ Danh sÃ¡ch action groups hiá»‡n cÃ³ (náº¿u cÃ³)
â€¢ NÃºt "Add Action Group" hoáº·c "Create Action Group"
```

#### **BÆ°á»›c 2: Báº¥m "Add Action Group"**

```
NÃºt: "Add Action Group" (gÃ³c pháº£i trÃªn)
Hoáº·c: NÃºt "Create" 

Dialog/form sáº½ má»Ÿ ra
```

#### **BÆ°á»›c 3: Nháº­p ThÃ´ng Tin Action Group**

```
Field 1: Action Group Name
   Nháº­p: "customer-recommendations-tools"
   
   Gá»£i Ã½:
   â€¢ TÃªn rÃµ rÃ ng, mÃ´ táº£ chá»©c nÄƒng
   â€¢ Format: kebab-case (dáº¥u gáº¡ch ngang)
   â€¢ VÃ­ dá»¥:
      - customer-data-tools
      - product-recommendation-tools
      - email-campaign-tools

Field 2: Description (Optional)
   Nháº­p: "Tools for retrieving customer data and product recommendations"
   
   Lá»£i Ã­ch:
   â€¢ GiÃºp nhá»› má»¥c Ä‘Ã­ch
   â€¢ Team members hiá»ƒu rÃµ
   â€¢ Dá»… maintain

Field 3: Action Group Type
   Chá»n: "Lambda function" hoáº·c "API" hoáº·c "OpenAPI schema"
   
   Lá»±a chá»n:
   â€¢ Lambda: AWS Lambda functions
   â€¢ API: REST API endpoints
   â€¢ OpenAPI: OpenAPI/Swagger definition
```

#### **BÆ°á»›c 4: Äá»‹nh NghÄ©a Actions (Tools)**

TÃ¹y theo loáº¡i, cÃ³ 2 cÃ¡ch chÃ­nh:

**CÃ¡ch A: Lambda Functions**

```
Field 1: Lambda Function Name
   Nháº­p: "get-customer-profile"
   
   Lambda ARN: arn:aws:lambda:us-east-1:ACCOUNT:function:get-customer-profile

Field 2: Function Input Schema (JSON)
   ```json
   {
     "type": "object",
     "properties": {
       "customer_id": {
         "type": "string",
         "description": "Customer ID"
       },
       "include_history": {
         "type": "boolean",
         "description": "Include purchase history"
       }
     },
     "required": ["customer_id"]
   }
   ```

Field 3: Function Output Description
   Nháº­p: "Returns customer profile including name, email, RFM segment, and purchase history"

Field 4: IAM Role Permissions
   âœ… Lambda execution role cáº§n:
      â€¢ lambda:InvokeFunction
      â€¢ bedrock:InvokeAgent
```

**CÃ¡ch B: API Endpoints**

```
Field 1: API Name
   Nháº­p: "product-recommendation-api"

Field 2: API Endpoint
   Nháº­p: "https://api.example.com/products/recommend"

Field 3: HTTP Method
   Chá»n: POST, GET, PUT

Field 4: Request Schema
   ```json
   {
     "type": "object",
     "properties": {
       "customer_segment": {
         "type": "string",
         "description": "Customer RFM segment"
       },
       "limit": {
         "type": "integer",
         "description": "Number of recommendations"
       }
     },
     "required": ["customer_segment"]
   }
   ```

Field 5: Response Schema
   ```json
   {
     "type": "object",
     "properties": {
       "recommendations": {
         "type": "array",
         "items": {
           "type": "object",
           "properties": {
             "product_id": {"type": "string"},
             "name": {"type": "string"},
             "score": {"type": "number"}
           }
         }
       }
     }
   }
   ```

Field 6: Authentication (Optional)
   Chá»n: None, API Key, OAuth2, Basic Auth
```

#### **BÆ°á»›c 5: ThÃªm Nhiá»u Actions (Tools) Náº¿u Cáº§n**

```
Báº¥m: "Add another action" hoáº·c "Add action"
Láº·p láº¡i BÆ°á»›c 4 cho má»—i tool

VÃ­ dá»¥ táº¡o 3 actions:
1. GetCustomerProfile
2. GetProductRecommendations
3. SendEmail
```

#### **BÆ°á»›c 6: Kiá»ƒm Tra Action Group Configuration**

```
Checklist:
â˜ Action Group Name: âœ“ Nháº­p
â˜ Description: âœ“ Nháº­p (optional)
â˜ Actions defined: âœ“ Ãt nháº¥t 1
â˜ Input schema: âœ“ Valid JSON
â˜ Output schema: âœ“ Valid JSON
â˜ IAM permissions: âœ“ Checked
â˜ API endpoints: âœ“ Accessible
```

#### **BÆ°á»›c 7: LÆ°u Action Group**

```
NÃºt: "Create Action Group" hoáº·c "Save"
Status: "Creating..."
Chá» vÃ i giÃ¢y

XÃ¡c nháº­n:
âœ… Action group Ä‘Æ°á»£c táº¡o
âœ… Status: Ready
âœ… CÃ³ thá»ƒ sá»­ dá»¥ng
```

### **VÃ­ Dá»¥ Action Groups Cho Lab**

#### **Action Group 1: Customer Data Tools**

```
Name: customer-data-tools

Actions:
1. GetCustomerProfile
   Input: {customer_id: string}
   Lambda: get-customer-profile
   Output: {customer_data}

2. GetCustomerSegment
   Input: {customer_id: string}
   Lambda: get-customer-segment
   Output: {segment: string}

3. GetPurchaseHistory
   Input: {customer_id: string, limit: int}
   Lambda: get-purchase-history
   Output: {purchases: array}
```

#### **Action Group 2: Product Recommendation Tools**

```
Name: product-recommendation-tools

Actions:
1. GetRecommendations
   Input: {segment: string, limit: int}
   API: POST /products/recommend
   Output: {recommendations: array}

2. SearchProducts
   Input: {query: string, category: string}
   API: GET /products/search
   Output: {products: array}

3. GetProductDetails
   Input: {product_id: string}
   API: GET /products/{id}
   Output: {product_data}
```

#### **Action Group 3: Communication Tools**

```
Name: communication-tools

Actions:
1. SendEmail
   Input: {to: string, subject: string, body: string}
   Lambda: send-email
   Output: {email_id: string, status: string}

2. SendNotification
   Input: {user_id: string, message: string}
   Lambda: send-notification
   Output: {notification_id: string}

3. LogActivity
   Input: {user_id: string, action: string, result: string}
   Lambda: log-activity
   Output: {log_id: string, timestamp: string}
```

### **Action Groups Best Practices**

```
âœ… Tá»‘t:
   â€¢ Má»™t action group cho má»™t category
   â€¢ TÃªn rÃµ rÃ ng, mÃ´ táº£ cÃ´ng viá»‡c
   â€¢ Input/Output schema chi tiáº¿t
   â€¢ Error handling Ä‘Æ°á»£c xÃ¡c Ä‘á»‹nh
   â€¢ Timeout há»£p lÃ½ (5-30 seconds)
   â€¢ Retry policy Ä‘Æ°á»£c Ä‘á»‹nh nghÄ©a

âŒ TrÃ¡nh:
   â€¢ QuÃ¡ nhiá»u actions trong 1 group
   â€¢ TÃªn khÃ´ng rÃµ ("Tool1", "Tool2")
   â€¢ Schema khÃ´ng Ä‘áº§y Ä‘á»§
   â€¢ KhÃ´ng cÃ³ error handling
   â€¢ Timeout quÃ¡ ngáº¯n
   â€¢ Actions khÃ´ng liÃªn quan á»Ÿ má»™t group
```

### **Action Groups Testing**

```
Sau khi táº¡o Action Groups:

1. Test má»—i action riÃªng láº»
   â€¢ ÄÃºng input format?
   â€¢ Output há»£p lÃ½?
   â€¢ Errors Ä‘Æ°á»£c handle?

2. Test Agent gá»i actions
   â€¢ Agent cÃ³ gá»i action Ä‘Ãºng?
   â€¢ Tool output sá»­ dá»¥ng Ä‘Ãºng?
   â€¢ Result Ä‘Æ°á»£c format tá»‘t?

3. End-to-end testing
   â€¢ Query â†’ Action â†’ Result
   â€¢ Entire workflow
   â€¢ Multiple tool calls
```

### **Action Groups & Agent Flow**

```
User Query:
"What products should I recommend for Loyal Customers?"

Agent Process:
1. âœ… Parse query (LLM)
2. âœ… Identify needed actions
   â†’ Cáº§n: GetRecommendations(segment="Loyal")
   
3. âœ… Call Action Groups
   â†’ Invoke: product-recommendation-tools/GetRecommendations
   
4. âœ… Get Results
   â†’ Response: {products: [P1, P2, P3]}
   
5. âœ… Process Results (LLM)
   â†’ Format: "For Loyal Customers, I recommend..."
   
6. âœ… Return to User
   â†’ Final answer with recommendations
```

---

## ğŸ“‹ Agent Configuration Checklist (Updated)

TrÆ°á»›c khi lÆ°u, kiá»ƒm tra táº¥t cáº£:

```
â˜ Agent Role
   âœ… Role: AmazonBedrockExecutionRoleForAgents_CSZ8RZ6GK66
   âœ… Status: Valid
   âœ… Permissions: Checked

â˜ Model LLM
   âœ… Model: Nova Lite
   âœ… Max tokens: 2048
   âœ… Temperature: 0.7 (or chosen value)

â˜ Instructions
   âœ… Length: 300-1500 characters
   âœ… Clear structure: Yes
   âœ… Specific tasks: Yes
   âœ… Constraints: Defined
   âœ… Output format: Clear

â˜ Knowledge Bases
   âœ… KB 1: customer-segmentation-kb âœ“
   âœ… KB 2: product-catalog-kb âœ“
   âœ… Status: All connected
   âœ… Retrieval method: Vector search

â˜ Guardrails
   âœ… PII protection: Enabled
   âœ… Content filtering: Enabled
   âœ… Custom policies: Defined (if needed)
   âœ… Status: Ready

â˜ Action Groups (NEW!)
   âœ… Action Group 1: Created
   âœ… Actions defined: âœ“ (GetCustomerData, GetRecommendations, etc.)
   âœ… Input schema: Valid JSON
   âœ… Output schema: Valid JSON
   âœ… Lambda/API: Configured
   âœ… IAM permissions: Verified
   âœ… Testing: Passed

â˜ Final Check
   âœ… No errors/warnings
   âœ… All required fields filled
   âœ… Configuration logical
   âœ… All 6 components ready
   âœ… Ready to save
```

---

## ğŸ’¾ LÆ°u Cáº¥u HÃ¬nh

### **CÃ¡c BÆ°á»›c LÆ°u:**

1. **Kiá»ƒm Tra ToÃ n Bá»™ Cáº¥u HÃ¬nh**
   ```
   âœ… Sá»­ dá»¥ng checklist á»Ÿ trÃªn
   âœ… Táº¥t cáº£ fields Ä‘iá»n Ä‘á»§
   âœ… KhÃ´ng cÃ³ errors
   ```

2. **Báº¥m "Save" hoáº·c "Update Agent"**
   ```
   NÃºt: "Save" (gÃ³c pháº£i trÃªn)
   Status: "Saving..."
   Chá» vÃ i giÃ¢y
   ```

3. **XÃ¡c Nháº­n ThÃ nh CÃ´ng**
   ```
   âœ… Status: "Successfully saved"
   âœ… Hoáº·c: "Agent updated"
   âœ… KhÃ´ng cÃ³ error messages
   ```

4. **Kiá»ƒm Tra Agent Status**
   ```
   Hiá»ƒn thá»‹:
   â€¢ Agent Status: ACTIVE âœ“
   â€¢ Last Updated: Just now
   â€¢ Version: [Latest]
   ```

---

## ğŸ§ª Test Agent

### **Sau Khi Cáº¥u HÃ¬nh HoÃ n Táº¥t:**

1. **VÃ o Test Console**
   ```
   NÃºt: "Test in Agent Builder"
   Hoáº·c: Tab "Test"
   Input field sáº½ hiá»‡n ra
   ```

2. **Viáº¿t Test Query**
   ```
   VÃ­ dá»¥:
   "What products should I recommend for Loyal Customers?"
   "Analyze customer segments and suggest marketing strategy"
   "Which products are suitable for at-risk customers?"
   ```

3. **Gá»­i Query**
   ```
   Báº¥m: "Send" hoáº·c Enter
   Status: "Processing..."
   Agent sáº½ gá»i KB, LLM, ...
   ```

4. **Kiá»ƒm Tra Output**
   ```
   Xem:
   â€¢ Agent response
   â€¢ Tool calls (Knowledge Base retrieval)
   â€¢ Reasoning steps
   â€¢ Final answer
   
   Kiá»ƒm tra:
   âœ… Káº¿t quáº£ há»£p lÃ½?
   âœ… DÃ¹ng Ä‘Ãºng KB?
   âœ… Format Ä‘Ãºng?
   âœ… CÃ³ errors?
   ```

---

## ğŸš€ Tiáº¿p Theo

Sau khi cáº¥u hÃ¬nh hoÃ n táº¥t:

1. **Test ThÃªm Nhiá»u Cases**
   - KhÃ¡c nhau customers
   - KhÃ¡c nhau products
   - Edge cases

2. **Fine-tune Instructions**
   - Dá»±a trÃªn test results
   - Cáº£i thiá»‡n output quality
   - ThÃªm constraints náº¿u cáº§n

3. **Táº¡o Action Groups (Tools)**
   - Lambda functions
   - API integrations
   - Database connections

4. **Deploy Agent**
   - Táº¡o alias (v1, prod, ...)
   - Set production version
   - Monitor performance

---

**ğŸ‰ Xin chÃºc má»«ng! Agent cá»§a báº¡n Ä‘Ã£ Ä‘Æ°á»£c cáº¥u hÃ¬nh hoÃ n chá»‰nh!**

**Tiáº¿p theo:** Test Agent & Táº¡o Action Groups! ğŸ¤–âœ¨